-GROUP CreateDeleteInt64NodeTrxTest
-DATASET CSV empty
--

-DEFINE_STATEMENT_BLOCK CREATE_TABLE_TEST [
-STATEMENT CREATE NODE TABLE User(name STRING, age INT64, PRIMARY KEY (name))
---- ok
-STATEMENT CREATE REL TABLE Follows(FROM User TO User, since INT64)
---- ok
]

-DEFINE_STATEMENT_BLOCK DROP_TABLE_TEST [
-STATEMENT DROP TABLE Follows;
---- ok
-STATEMENT DROP TABLE User;
---- ok
]

-DEFINE_STATEMENT_BLOCK CREATE_DROP_TABLE_ROLLBACK [
-STATEMENT MATCH (u:User) return u.*
---- 0
]

-DEFINE_STATEMENT_BLOCK CREATE_DROP_TABLE_ONE_TX_ROLLBACK [
-STATEMENT MATCH (u:User) return u.*
---- error
Binder exception: Table User does not exist.
]

-DEFINE_STATEMENT_BLOCK CREATE_DROP_TABLE_COMMIT [
-STATEMENT MATCH (u:User) return u.*
---- error
Binder exception: Table User does not exist.
]


-DEFINE_STATEMENT_BLOCK DROP_REL_TABLE_TEST [
-STATEMENT DROP TABLE Follows;
---- ok
]

-DEFINE_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_ROLLBACK [
-STATEMENT MATCH (u:User)-[:Follows]->() return u.*
---- 0
]

-DEFINE_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_ONE_TX_ROLLBACK [
-STATEMENT MATCH (u:User)-[:Follows]->() return u.*
---- error
Binder exception: Table User does not exist.
]

-DEFINE_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_COMMIT [
-STATEMENT MATCH (u:User)-[:Follows]->() return u.*
---- error
Binder exception: Table Follows does not exist.
]

-CASE createDropTableCommit
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK DROP_TABLE_TEST
-STATEMENT COMMIT
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_COMMIT

-CASE createDropTableCommitRecovery
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK DROP_TABLE_TEST
-STATEMENT COMMIT_SKIP_CHECKPOINT
---- ok
-RELOADDB
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_COMMIT

-CASE createDropTableRollback
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK DROP_TABLE_TEST
-STATEMENT Rollback
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_ROLLBACK

-CASE createDropTableRollbackRecovery
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK DROP_TABLE_TEST
-STATEMENT Rollback_skip_checkpoint
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_ROLLBACK


-CASE createDropRelTableCommit
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK DROP_REL_TABLE_TEST
-STATEMENT COMMIT
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_COMMIT

-CASE createDropRelTableCommitRecovery
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK DROP_REL_TABLE_TEST
-STATEMENT COMMIT_skip_checkpoint
---- ok
-RELOADDB
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_COMMIT

-CASE createDropRelTableCommitRollback
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK DROP_REL_TABLE_TEST
-STATEMENT Rollback
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_ROLLBACK

-CASE createDropRelTableCommitRollbackRecovery
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK DROP_REL_TABLE_TEST
-STATEMENT Rollback_SKIP_CHECKPOINT
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_ROLLBACK

-CASE createDropTableOneTxCommit
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-INSERT_STATEMENT_BLOCK DROP_TABLE_TEST
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_COMMIT
-STATEMENT COMMIT
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_COMMIT

-CASE createDropTableOneTxCommitRecovery
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-INSERT_STATEMENT_BLOCK DROP_TABLE_TEST
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_COMMIT
-STATEMENT COMMIT_SKIP_CHECKPOINT
---- ok
-RELOADDB
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_COMMIT

-CASE createDropTableOneTxRollback
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-INSERT_STATEMENT_BLOCK DROP_TABLE_TEST
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_COMMIT
-STATEMENT Rollback
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_ONE_TX_ROLLBACK

-CASE createDropTableOneTxRollbackRecovery
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-INSERT_STATEMENT_BLOCK DROP_TABLE_TEST
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_COMMIT
-STATEMENT Rollback_skip_checkpoint
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_TABLE_ONE_TX_ROLLBACK

-CASE createDropRelTableOneTxCommit
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-INSERT_STATEMENT_BLOCK DROP_REL_TABLE_TEST
-STATEMENT COMMIT
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_COMMIT

-CASE createDropRelTableOneTxCommitRecovery
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-INSERT_STATEMENT_BLOCK DROP_REL_TABLE_TEST
-STATEMENT COMMIT_SKIP_CHECKPOINT
---- ok
-RELOADDB
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_COMMIT

-CASE createDropRelTableOneTxCommitRollback
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-INSERT_STATEMENT_BLOCK DROP_REL_TABLE_TEST
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_COMMIT
-STATEMENT Rollback
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_ONE_TX_ROLLBACK

-CASE createDropRelTableOneTxCommitRollbackRecovery
-STATEMENT BEGIN TRANSACTION
---- ok
-INSERT_STATEMENT_BLOCK CREATE_TABLE_TEST
-INSERT_STATEMENT_BLOCK DROP_REL_TABLE_TEST
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_COMMIT
-STATEMENT Rollback_SKIP_CHECKPOINT
---- ok
-INSERT_STATEMENT_BLOCK CREATE_DROP_REL_TABLE_ONE_TX_ROLLBACK
